name: AI Evolution (Grok) - CLI Version

on:
  schedule:
    - cron: '0 9 * * *'   # UTC 9:00 (JST 18:00)
    - cron: '0 21 * * *'  # UTC 21:00 (JST 6:00)
  workflow_dispatch:
    inputs:
      retry_count:
        description: 'Current retry attempt (0-2)'
        required: false
        default: '0'
        type: string

permissions:
  contents: write
  pull-requests: write
  id-token: write
  actions: write  # Required for workflow re-trigger

jobs:
  evolve-grok-cli:
    uses: ./.github/workflows/reusable-evolve-model-skill-cli.yml
    with:
      model_id: 'grok'
      model_display_name: 'Grok (CLI)'
      anthropic_model: 'x-ai/grok-code-fast-1'
      commit_prefix: 'ðŸ¤– AI Evolution (CLI)'
    secrets:
      model_api_key: ${{ secrets.GROK_API_KEY }}
      ga4_property_id: ${{ secrets.GA4_PROPERTY_ID }}
      google_application_credentials_json: ${{ secrets.GOOGLE_APPLICATION_CREDENTIALS_JSON }}
      serper_api_key: ${{ secrets.SERPER_API_KEY }}

  deploy:
    needs: evolve-grok-cli
    if: needs.evolve-grok-cli.result == 'success'
    uses: ./.github/workflows/deploy.yml
    secrets: inherit

  handle-retry:
    needs: evolve-grok-cli
    if: always()
    uses: ./.github/workflows/reusable-retry-handler.yml
    with:
      workflow_name: 'AI Evolution (Grok) - CLI Version'
      job_result: ${{ needs.evolve-grok-cli.result }}
      retry_count: ${{ inputs.retry_count || '0' }}
