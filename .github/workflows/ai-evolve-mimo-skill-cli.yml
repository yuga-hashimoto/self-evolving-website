name: AI Evolution (MiMo) - CLI Version

on:
  schedule:
    - cron: '30 9 * * *'   # UTC 9:30 (JST 18:30)
    - cron: '30 21 * * *'  # UTC 21:30 (JST 6:30)
  workflow_dispatch:
    inputs:
      retry_count:
        description: 'Current retry attempt (0-2)'
        required: false
        default: '0'
        type: string

permissions:
  contents: write
  pull-requests: write
  id-token: write
  actions: write  # Required for workflow re-trigger

jobs:
  evolve-mimo-cli:
    uses: ./.github/workflows/reusable-evolve-model-skill-cli.yml
    with:
      model_id: 'mimo'
      model_display_name: 'AI 1 (CLI)'
      anthropic_model: 'z-ai/glm-4.5-air:free'
      commit_prefix: 'ðŸ†“ AI Evolution (CLI)'
    secrets:
      model_api_key: ${{ secrets.MIMO_API_KEY }}
      ga4_property_id: ${{ secrets.GA4_PROPERTY_ID }}
      google_application_credentials_json: ${{ secrets.GOOGLE_APPLICATION_CREDENTIALS_JSON }}
      serper_api_key: ${{ secrets.SERPER_API_KEY }}

  deploy:
    needs: evolve-mimo-cli
    if: needs.evolve-mimo-cli.result == 'success'
    uses: ./.github/workflows/deploy.yml
    secrets: inherit

  handle-retry:
    needs: evolve-mimo-cli
    if: always()
    uses: ./.github/workflows/reusable-retry-handler.yml
    with:
      workflow_name: 'AI Evolution (MiMo) - CLI Version'
      job_result: ${{ needs.evolve-mimo-cli.result }}
      retry_count: ${{ inputs.retry_count || '0' }}
